import '../batch/status.dart';
import '../copy_with_sentinel.dart';

/// A file generated on behalf of a user (e.g., video generated by Veo).
class GeneratedFile {
  /// Identifier. The name of the generated file.
  /// Example: `generatedFiles/abc-123`
  final String? name;

  /// MIME type of the generated file.
  final String? mimeType;

  /// Output only. The state of the GeneratedFile.
  final GeneratedFileState? state;

  /// Error details if the GeneratedFile ends up in the STATE_FAILED state.
  final Status? error;

  /// Creates a [GeneratedFile].
  const GeneratedFile({this.name, this.mimeType, this.state, this.error});

  /// Creates a [GeneratedFile] from JSON.
  factory GeneratedFile.fromJson(Map<String, dynamic> json) => GeneratedFile(
    name: json['name'] as String?,
    mimeType: json['mimeType'] as String?,
    state: json['state'] != null
        ? generatedFileStateFromString(json['state'] as String?)
        : null,
    error: json['error'] != null
        ? Status.fromJson(json['error'] as Map<String, dynamic>)
        : null,
  );

  /// Converts to JSON.
  Map<String, dynamic> toJson() => {
    if (name != null) 'name': name,
    if (mimeType != null) 'mimeType': mimeType,
    if (state != null) 'state': generatedFileStateToString(state),
    if (error != null) 'error': error!.toJson(),
  };

  /// Creates a copy with replaced values.
  GeneratedFile copyWith({
    Object? name = unsetCopyWithValue,
    Object? mimeType = unsetCopyWithValue,
    Object? state = unsetCopyWithValue,
    Object? error = unsetCopyWithValue,
  }) {
    return GeneratedFile(
      name: name == unsetCopyWithValue ? this.name : name as String?,
      mimeType: mimeType == unsetCopyWithValue
          ? this.mimeType
          : mimeType as String?,
      state: state == unsetCopyWithValue
          ? this.state
          : state as GeneratedFileState?,
      error: error == unsetCopyWithValue ? this.error : error as Status?,
    );
  }
}

/// The state of a GeneratedFile.
enum GeneratedFileState {
  /// The default value. This value is used if the state is omitted.
  unspecified,

  /// Being generated.
  generating,

  /// Generated and is ready for download.
  generated,

  /// Failed to generate the GeneratedFile.
  failed,
}

/// Converts a string to a [GeneratedFileState].
GeneratedFileState generatedFileStateFromString(String? value) {
  return switch (value) {
    'STATE_UNSPECIFIED' => GeneratedFileState.unspecified,
    'GENERATING' => GeneratedFileState.generating,
    'GENERATED' => GeneratedFileState.generated,
    'FAILED' => GeneratedFileState.failed,
    _ => GeneratedFileState.unspecified,
  };
}

/// Converts a [GeneratedFileState] to a string.
String generatedFileStateToString(GeneratedFileState? state) {
  return switch (state) {
    GeneratedFileState.unspecified => 'STATE_UNSPECIFIED',
    GeneratedFileState.generating => 'GENERATING',
    GeneratedFileState.generated => 'GENERATED',
    GeneratedFileState.failed => 'FAILED',
    null => 'STATE_UNSPECIFIED',
  };
}
